2022-10-23 16:20:43.558 -05:00 [INF] Entity Framework Core 6.0.10 initialized 'TicketsContext' using provider 'Oracle.EntityFrameworkCore:6.0.21.1-20220418' with options: MigrationsHistoryTable=_MigrationHistory OracleSQLCompatibility=11 
2022-10-23 16:20:44.196 -05:00 [INF] Executed DbCommand (89ms) [Parameters=[], CommandType='"Text"', CommandTimeout='0']
SELECT t.table_name FROM user_tables t WHERE t.table_name = N'_MigrationHistory'
2022-10-23 16:20:44.293 -05:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='0']
SELECT t.table_name FROM user_tables t WHERE t.table_name = N'_MigrationHistory'
2022-10-23 16:20:44.367 -05:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='0']
SELECT "MigrationId", "ProductVersion"
FROM "_MigrationHistory"
ORDER BY "MigrationId"
2022-10-23 16:20:44.389 -05:00 [INF] Applying migration '20221023211747_Ticket code seq added'.
2022-10-23 16:20:44.484 -05:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='0']
CREATE SEQUENCE "sq_ticket_code" START WITH 1 INCREMENT BY 1 NOMINVALUE NOMAXVALUE NOCYCLE
2022-10-23 16:20:44.491 -05:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='0']
begin
execute immediate
'drop sequence SQ_Code';
exception
when others then
if sqlcode <> -2289 then
raise;
end if;
end;
2022-10-23 16:20:44.495 -05:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='0']
begin
execute immediate
'drop trigger TR_Code';
exception
when others then
if sqlcode <> -4080 then
raise;
end if;
end;
2022-10-23 16:20:44.547 -05:00 [ERR] 2022-10-23 16:20:44.537319 ThreadID:1   (ERROR)   OracleRelationalCommand.ExecuteNonQuery() :  Oracle.ManagedDataAccess.Client.OracleException (0x80004005): ORA-22818: subquery expressions not allowed here
ORA-06512: at line 10
   at OracleInternal.ServiceObjects.OracleConnectionImpl.VerifyExecution(Int32& cursorId, Boolean bThrowArrayBindRelatedErrors, SqlStatementType sqlStatementType, Int32 arrayBindCount, OracleException& exceptionForArrayBindDML, Boolean& hasMoreRowsInDB, Boolean bFirstIterationDone)
   at OracleInternal.ServiceObjects.OracleCommandImpl.ExecuteNonQuery(String commandText, OracleParameterCollection paramColl, CommandType commandType, OracleConnectionImpl connectionImpl, Int32 longFetchSize, Int64 clientInitialLOBFS, OracleDependencyImpl orclDependencyImpl, Int64[]& scnFromExecution, OracleParameterCollection& bindByPositionParamColl, Boolean& bBindParamPresent, OracleException& exceptionForArrayBindDML, OracleConnection connection, Boolean isFromEF)
   at Oracle.ManagedDataAccess.Client.OracleCommand.ExecuteNonQuery()
   at Oracle.EntityFrameworkCore.Storage.Internal.OracleRelationalCommandBuilderFactory.OracleRelationalCommandBuilder.OracleRelationalCommand.ExecuteNonQuery(RelationalCommandParameterObject parameterObject)
2022-10-23 16:20:44.553 -05:00 [ERR] Failed executing DbCommand (54ms) [Parameters=[], CommandType='"Text"', CommandTimeout='0']
declare
   l_nullable user_tab_columns.nullable % type;
begin 
   select nullable into l_nullable 
   from user_tab_columns 
  where table_name = 'Ticket' 
  and column_name = 'Code' 
;
   if l_nullable = 'N' then 
        EXECUTE IMMEDIATE 'ALTER TABLE "Ticket" MODIFY "Code" NUMBER(10) DEFAULT (SELECT sq_ticket_code.NEXTVAL FROM dual) ';
 else 
        EXECUTE IMMEDIATE 'ALTER TABLE "Ticket" MODIFY "Code" NUMBER(10) DEFAULT (SELECT sq_ticket_code.NEXTVAL FROM dual) NOT NULL';
 end if;
end;
